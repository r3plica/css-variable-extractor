<div *ngIf="viewModel$ | async as vm">
  <!-- Stepper -->
  <app-stepper />

  <main
    class="relative flex flex-col min-w-0 break-words bg-white w-full mb-6 shadow-lg rounded"
  >
    <div class="px-4 py-5 flex-auto">
      <!-- Step 1: JSON Input -->
      <ng-container *ngIf="vm.activeStep === 0">
        <!-- Error message for the form -->
        <div
          class="text-white px-6 py-4 border-0 rounded relative mb-4 bg-red-500"
          *ngIf="
            vm.errors[vm.activeStep] &&
            vm.cssForm?.touched &&
            !vm.cssForm?.valid
          "
        >
          <span class="text-xl inline-block mr-5 align-middle">
            <i class="fas fa-bell"></i>
          </span>
          <span class="inline-block align-middle mr-8">
            <b class="capitalize">Error!</b> {{ vm.errors[vm.activeStep] }}
          </span>
          <button
            class="absolute bg-transparent text-2xl font-semibold leading-none right-0 top-0 mt-4 mr-6 outline-none focus:outline-none"
          >
            <span>Ã—</span>
          </button>
        </div>

        <form
          [formGroup]="vm.cssForm"
          (ngSubmit)="parseCss()"
          class="mt-4"
          *ngIf="vm.cssForm"
        >
          <input
            type="file"
            (change)="handleFileInput($event)"
            accept=".json"
            class="px-3 py-3 placeholder-blueGray-300 text-blueGray-600 relative bg-white rounded text-sm shadow outline-none focus:outline-none focus:shadow-outline w-full mt-4 border-blueGray-600 border"
          />

          <app-form-error
            [form]="vm.cssForm"
            controlName="jsonInput"
            errorMessage="You must select a JSON file."
          />

          <app-json-viewer [form]="vm.cssForm" controlName="xpath" />

          <input
            formControlName="xpath"
            type="text"
            class="px-3 py-3 placeholder-blueGray-300 text-blueGray-600 relative bg-white rounded text-sm shadow outline-none focus:outline-none focus:shadow-outline w-full mt-4"
            placeholder="Enter XPath to extract CSS data..."
          />

          <app-form-error [form]="vm.cssForm" controlName="xpath" />

          <label class="flex items-center mt-4">
            <input
              type="checkbox"
              formControlName="mergeDuplicates"
              class="mr-2"
            />
            Merge Duplicates
          </label>

          <label class="flex items-center mt-4">
            <input
              type="checkbox"
              formControlName="existingStructure"
              class="mr-2"
            />
            Keep existing structure
          </label>

          <label class="flex items-center mt-4">
            <input
              type="checkbox"
              formControlName="advancedConfiguration"
              class="mr-2"
            />
            Advanced configuration
          </label>

          <div class="mt-6 flex justify-end gap-4">
            <button
              type="button"
              (click)="clearInput()"
              class="bg-blueGray-500 text-white active:bg-blueGray-600 font-bold uppercase text-sm px-6 py-3 rounded shadow hover:shadow-lg outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150"
            >
              Clear
            </button>
            <button
              type="submit"
              class="bg-red-500 text-white active:bg-red-600 font-bold uppercase text-sm px-6 py-3 rounded shadow hover:shadow-lg outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150"
            >
              Parse
            </button>
          </div>
        </form>
      </ng-container>

      <app-variables *ngIf="vm.activeStep === 1" />
      <app-results *ngIf="vm.activeStep === 2" />
    </div>
  </main>
</div>
